(self.webpackChunksmarthome=self.webpackChunksmarthome||[]).push([[880],{1880:function(e,t,i){"use strict";i.r(t),i.d(t,{HomeComponent:function(){return r}}),i(285);var o=i(7521),n=i.n(o);i(2148);class r extends HTMLElement{constructor(){super(),this.inProgress=!1,this.innerHTML=n()}connectedCallback(){this.abortContoller=new AbortController,this.querySelector("#lauter").addEventListener("click",(()=>this.lauterClick()),{signal:this.abortContoller.signal}),this.querySelector("#leiser").addEventListener("click",(()=>this.leiserClick()),{signal:this.abortContoller.signal}),this.querySelector("#quelleAlexa").addEventListener("click",(()=>this.quelleAlexaClick()),{signal:this.abortContoller.signal}),this.querySelector("#quelleMonitor").addEventListener("click",(()=>this.quelleMonitorClick()),{signal:this.abortContoller.signal}),this.querySelector("#toggleDBFB").addEventListener("click",(()=>this.toggleDBFBClick()),{signal:this.abortContoller.signal}),this.updateProgress(!1)}setGoogleAccessToken(e){this.googleAccessToken=e}updateProgress(e){this.inProgress=e;let t=this.querySelector("#progress");this.querySelectorAll("button").forEach((t=>e?t.setAttribute("disabled","disabled"):t.removeAttribute("disabled"))),t.style.display=e?"":"none"}async executeParticleFunction(e,t){try{if(this.inProgress)return;this.updateProgress(!0);let i=await this.getParticleToken(),o=new URLSearchParams;o.set("arg",t),await fetch(`https://api.particle.io/v1/devices/4e0033000651343530343432/${e}`,{method:"POST",body:o,headers:{Authorization:`Bearer ${i}`,"Content-Type":"application/x-www-form-urlencoded"}})}finally{this.updateProgress(!1)}}async lauterClick(){await this.executeParticleFunction("control","i")}async leiserClick(){await this.executeParticleFunction("control","d")}async quelleAlexaClick(){await this.executeParticleFunction("control","v")}async quelleMonitorClick(){await this.executeParticleFunction("control","c")}async toggleDBFBClick(){await this.executeParticleFunction("control","b")}disconnectedCallback(){this.abortContoller.abort()}async getParticleToken(){if(null!=this.particleToken&&+new Date<this.particleToken.exp)return this.particleToken.token;let e=new URLSearchParams;e.set("grant_type","urn:ietf:params:oauth:grant-type:token-exchange"),e.set("subject_token",this.googleAccessToken),e.set("subject_token_type","urn:ietf:params:oauth:token-type:access_token");let t=await fetch("https://particle-google-auth-bridge.grapp.workers.dev/token",{method:"POST",body:e,headers:{"Content-Type":"application/x-www-form-urlencoded"}});if(!t.ok)throw new Error(`Could not acquire particle token: Status: ${t.status}`);let i=await t.json(),o=+new Date+1e3*parseInt(i.expires_in);return this.particleToken={exp:o,token:i.access_token},this.particleToken.token}}customElements.define("home-component",r)},7521:function(e){e.exports='<div class="container"> <div class="spinner-container"> <paper-spinner active="" id="progress"></paper-spinner> </div> <div class="group"> <h1>Volume</h1> <button id="leiser">ðŸ”‰</button> <button id="lauter">ðŸ”Š</button> </div> <div class="group"> <h1>Source</h1> <button id="quelleAlexa">Alexa</button> <button id="quelleMonitor">Monitor</button> </div> <div class="group"> <h1>Sound</h1> <button id="toggleDBFB">DBFB</button> </div> </div>'}}]);
//# sourceMappingURL=823c062fbdfba6bae661.bundle.js.map