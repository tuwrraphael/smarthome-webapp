!function(){"use strict";var e,t,n,i={2875:function(e,t,n){n(285),n(5306);var i=n(8402);class o extends HTMLElement{constructor(){super(),this.innerHTML='<div class="login-container"> <form method="GET" action="https://accounts.google.com/o/oauth2/v2/auth" id="login_form"> <input type="hidden" name="client_id" id="client_id" value="183140089369-730bg2gdo8g0r5useg6q0s5cf0i6l4as.apps.googleusercontent.com"> <input type="hidden" name="redirect_uri" id="redirect_uri"> <input type="hidden" name="response_type" value="token id_token"> <input type="hidden" name="login_hint" id="login_hint"> <input type="hidden" name="nonce" id="nonce"> <input type="hidden" name="scope" value="openid"> <button type="submit">Login with Google</button> </form> </div>'}connectedCallback(){this.nonceInput=this.querySelector("#nonce"),this.redirectUriInput=this.querySelector("#redirect_uri"),this.redirectUriInput.value=window.location.href.replace(/\/login|(\?.+)|(\#.+)/g,"").replace(/(\/$)/g,""),this.loginHintInput=this.querySelector("#login_hint"),this.loginForm=this.querySelector("#login_form"),this.nonceInput.value=function(e){for(var t="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i=0;i<8;i++)t+=n.charAt(Math.floor(Math.random()*n.length));return t}(),"FederatedCredential"in window&&navigator.credentials.get({federated:{providers:["https://google.smarthome-app.kesal.at"]},mediation:"optional"}).then((e=>{e&&"federated"==e.type&&(this.loginHintInput.value=e.id,this.loginForm.submit())}))}disconnectedCallback(){}}customElements.define("login-component",o);class r extends HTMLElement{constructor(){super(),this.inProgress=!1,this.innerHTML='<div class="container"> <div class="spinner-container"> <paper-spinner active="" id="progress"></paper-spinner> </div> <div class="group"> <h1>Volume</h1> <input type="range" min="0" max="8" id="volume-slider"> </div> <div class="group"> <h1>Source</h1> <button id="quelleAlexa">Alexa</button> <button id="quelleMonitor">Monitor</button> </div> <div class="group"> <h1>Sound</h1> <button id="toggleDBFB">DBFB</button> </div> </div>'}connectedCallback(){this.abortContoller=new AbortController;let e=this.querySelector("#volume-slider");e.addEventListener("input",(()=>this.volumeInput()),{signal:this.abortContoller.signal}),e.addEventListener("change",(()=>this.volumeChanged()),{signal:this.abortContoller.signal}),this.maxVolume=parseInt(e.max),this.middleValue=this.maxVolume/2,this.querySelector("#quelleAlexa").addEventListener("click",(()=>this.quelleAlexaClick()),{signal:this.abortContoller.signal}),this.querySelector("#quelleMonitor").addEventListener("click",(()=>this.quelleMonitorClick()),{signal:this.abortContoller.signal}),this.querySelector("#toggleDBFB").addEventListener("click",(()=>this.toggleDBFBClick()),{signal:this.abortContoller.signal}),this.updateProgress(!1),n.e(148).then(n.bind(n,2148)).catch((e=>{console.error("error loading spinner",e)})),document.addEventListener("keypress",(async e=>{"+"===e.key?await this.executeParticleFunction("control","i1"):"-"===e.key&&await this.executeParticleFunction("control","d1")}),{signal:this.abortContoller.signal})}volumeInput(){this.lastValue=parseInt(this.querySelector("#volume-slider").value)}setGoogleAccessToken(e){this.googleAccessToken=e}updateProgress(e){this.inProgress=e;let t=this.querySelector("#progress");this.querySelectorAll("button").forEach((t=>e?t.setAttribute("disabled","disabled"):t.removeAttribute("disabled"))),e?this.querySelector("#volume-slider").setAttribute("disabled","disabled"):this.querySelector("#volume-slider").removeAttribute("disabled"),t.style.display=e?"":"none"}async executeParticleFunction(e,t){console.log(e,t);try{if(this.inProgress)return;this.updateProgress(!0);let n=await this.getParticleToken(),i=new URLSearchParams;i.set("arg",t),await fetch(`https://api.particle.io/v1/devices/4e0033000651343530343432/${e}`,{method:"POST",body:i,headers:{Authorization:`Bearer ${n}`,"Content-Type":"application/x-www-form-urlencoded"}})}finally{this.updateProgress(!1)}}async volumeChanged(){this.lastValue<this.middleValue?await this.executeParticleFunction("control","d"+(this.middleValue-this.lastValue)):this.lastValue>this.middleValue&&await this.executeParticleFunction("control","i"+(this.lastValue-this.middleValue)),this.querySelector("#volume-slider").value=`${this.middleValue}`}async quelleAlexaClick(){await this.executeParticleFunction("control","v")}async quelleMonitorClick(){await this.executeParticleFunction("control","c")}async toggleDBFBClick(){await this.executeParticleFunction("control","b")}disconnectedCallback(){this.abortContoller.abort()}async getParticleToken(){if(null!=this.particleToken&&+new Date<this.particleToken.exp)return this.particleToken.token;let e=new URLSearchParams;e.set("grant_type","urn:ietf:params:oauth:grant-type:token-exchange"),e.set("subject_token",this.googleAccessToken),e.set("subject_token_type","urn:ietf:params:oauth:token-type:access_token");let t=await fetch("https://particle-google-auth-bridge.grapp.workers.dev/token",{method:"POST",body:e,headers:{"Content-Type":"application/x-www-form-urlencoded"}});if(!t.ok)throw new Error(`Could not acquire particle token: Status: ${t.status}`);let n=await t.json(),i=+new Date+1e3*parseInt(n.expires_in);return this.particleToken={exp:i,token:n.access_token},this.particleToken.token}}customElements.define("home-component",r),"serviceWorker"in navigator&&window.addEventListener("load",(async()=>{navigator.serviceWorker.register("./sw.js").then((e=>{})).catch((e=>{console.log("SW registration failed: ",e)}))})),async function(){let e=await async function(){const e="smarthome-webapp-token";let t=sessionStorage.getItem(e);if(null!=t){let e=JSON.parse(t);if(e.exp>+new Date)return e}let n=new URLSearchParams(window.location.hash.replace(/^#/,"")),i=n.get("access_token");if(i){history.replaceState(null,null," ");let t=await fetch(`https://oauth2.googleapis.com/tokeninfo?access_token=${i}`);if(!t.ok)throw new Error(`access token validation resulted in ${t.status}`);let r={access_token:i,exp:+new Date+1e3*parseInt(n.get("expires_in"))};if(sessionStorage.setItem(e,JSON.stringify(r)),"FederatedCredential"in window){let e=await t.json();var o=await navigator.credentials.create({federated:{id:e.sub,provider:"https://google.smarthome-app.kesal.at"}});await navigator.credentials.store(o)}return r}return null}(),t=new i.F0(new class{async resolve(t,n,i){switch(n){case"login":return new o;default:let t=new r;return t.setGoogleAccessToken(e.access_token),t}}},new i.NP(document.getElementById("content")));t.run(),e?setTimeout((()=>{window.location.reload()}),e.exp-1e3-+new Date):t.navigate("login","Login",!0)}().catch((e=>console.error(e)))}},o={};function r(e){var t=o[e];if(void 0!==t)return t.exports;var n=o[e]={exports:{}};return i[e](n,n.exports,r),n.exports}r.m=i,e=[],r.O=function(t,n,i,o){if(!n){var a=1/0;for(c=0;c<e.length;c++){n=e[c][0],i=e[c][1],o=e[c][2];for(var s=!0,l=0;l<n.length;l++)(!1&o||a>=o)&&Object.keys(r.O).every((function(e){return r.O[e](n[l])}))?n.splice(l--,1):(s=!1,o<a&&(a=o));s&&(e.splice(c--,1),t=i())}return t}o=o||0;for(var c=e.length;c>0&&e[c-1][2]>o;c--)e[c]=e[c-1];e[c]=[n,i,o]},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,{a:t}),t},r.d=function(e,t){for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.f={},r.e=function(e){return Promise.all(Object.keys(r.f).reduce((function(t,n){return r.f[n](e,t),t}),[]))},r.u=function(e){return"c486ff9f3f6eefb29595.bundle.js"},r.miniCssF=function(e){},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t={},n="smarthome:",r.l=function(e,i,o,a){if(t[e])t[e].push(i);else{var s,l;if(void 0!==o)for(var c=document.getElementsByTagName("script"),u=0;u<c.length;u++){var d=c[u];if(d.getAttribute("src")==e||d.getAttribute("data-webpack")==n+o){s=d;break}}s||(l=!0,(s=document.createElement("script")).charset="utf-8",s.timeout=120,r.nc&&s.setAttribute("nonce",r.nc),s.setAttribute("data-webpack",n+o),s.src=e),t[e]=[i];var h=function(n,i){s.onerror=s.onload=null,clearTimeout(p);var o=t[e];if(delete t[e],s.parentNode&&s.parentNode.removeChild(s),o&&o.forEach((function(e){return e(i)})),n)return n(i)},p=setTimeout(h.bind(null,void 0,{type:"timeout",target:s}),12e4);s.onerror=h.bind(null,s.onerror),s.onload=h.bind(null,s.onload),l&&document.head.appendChild(s)}},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.p="/",function(){var e={826:0};r.f.j=function(t,n){var i=r.o(e,t)?e[t]:void 0;if(0!==i)if(i)n.push(i[2]);else{var o=new Promise((function(n,o){i=e[t]=[n,o]}));n.push(i[2]=o);var a=r.p+r.u(t),s=new Error;r.l(a,(function(n){if(r.o(e,t)&&(0!==(i=e[t])&&(e[t]=void 0),i)){var o=n&&("load"===n.type?"missing":n.type),a=n&&n.target&&n.target.src;s.message="Loading chunk "+t+" failed.\n("+o+": "+a+")",s.name="ChunkLoadError",s.type=o,s.request=a,i[1](s)}}),"chunk-"+t,t)}},r.O.j=function(t){return 0===e[t]};var t=function(t,n){var i,o,a=n[0],s=n[1],l=n[2],c=0;for(i in s)r.o(s,i)&&(r.m[i]=s[i]);if(l)var u=l(r);for(t&&t(n);c<a.length;c++)o=a[c],r.o(e,o)&&e[o]&&e[o][0](),e[a[c]]=0;return r.O(u)},n=self.webpackChunksmarthome=self.webpackChunksmarthome||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))}();var a=r.O(void 0,[401],(function(){return r(2875)}));a=r.O(a)}();
//# sourceMappingURL=87c1d52e2b9266b7efc2.bundle.js.map